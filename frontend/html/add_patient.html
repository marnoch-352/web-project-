<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Patient - Cardiac Rehab</title>
    <link rel="stylesheet" href="../style/style.css">
    <link rel="stylesheet" href="../style/dashboard.css">
</head>

<body style="min-height: 100vh; display: flex; flex-direction: column; background-color: #f5f5f5;">

    <!-- Header -->
    <div class="header-bg">
        <h2 class="text-2xl font-bold">Add New Patient</h2>
        <div style="display: flex; gap: 1rem;">
            <button class="btn btn-secondary" style="border-radius: 10px;"
                onclick="window.location.href='Doctor_dashboard.html'">Back to Dashboard</button>
            <button class="btn btn-secondary" onclick="logout()">Logout</button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container" style="flex: 1;">
        <div class="staff-form">
            <h1 class="text-3xl font-bold text-primary-blue mb-2" style="text-align: center;">
                Patient Registration
            </h1>

            <form id="addPatientForm">
                <!-- Basic Information -->
                <div class="form-group">
                    <label>Phone Number <span style="color: red;">*</span></label>
                    <input type="tel" class="form-input" id="phone" required>
                    <small style="color: #666;">This will be used as username for patient login</small>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>First Name <span style="color: red;">*</span></label>
                        <input type="text" class="form-input" id="firstName" required>
                    </div>
                    <div class="form-group">
                        <label>Last Name <span style="color: red;">*</span></label>
                        <input type="text" class="form-input" id="lastName" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>Thai National ID (13 digits) <span style="color: red;">*</span></label>
                    <input type="text" class="form-input" id="nationalId" maxlength="13" pattern="\d{13}" required>
                    <small style="color: #666;">Exactly 13 digits. This will be used as password for patient
                        login.</small>
                </div>

                <!-- Medical History Section -->
                <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 2px solid var(--primary-blue);">
                    <h3 class="text-2xl font-bold text-primary-blue mb-2">Medical History</h3>

                    <div class="form-group">
                        <label>อาการของผู้ป่วย (ก่อนเข้ารับการออกกำลังกาย) <span style="color: red;">*</span></label>
                        <textarea class="form-input" id="symptoms" rows="3" required></textarea>
                    </div>

                    <div class="form-group">
                        <label>หัตถการที่ได้รับมา (Procedure) <span style="color: red;">*</span></label>
                        <textarea class="form-input" id="procedureHistory" rows="3" required></textarea>
                    </div>
                </div>

                <!-- Physical Measurements Section -->
                <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 2px solid var(--primary-blue);">
                    <h3 class="text-2xl font-bold text-primary-blue mb-2">Physical Measurements</h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label>น้ำหนัก (kg) <span style="color: red;">*</span></label>
                            <input type="number" class="form-input" id="weight" min="1" max="500" required>
                        </div>
                        <div class="form-group">
                            <label>ส่วนสูง (cm) <span style="color: red;">*</span></label>
                            <input type="number" class="form-input" id="height" min="1" max="300" required>
                        </div>
                        <div class="form-group">
                            <label>อายุ (ปี) <span style="color: red;">*</span></label>
                            <input type="number" class="form-input" id="age" min="1" max="150" required>
                        </div>
                    </div>
                </div>

                <!-- CPET Section -->
                <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 2px solid var(--primary-blue);">
                    <h3 class="text-2xl font-bold text-primary-blue mb-2">Exercise Testing</h3>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="cpetCompleted"
                                style="width: auto; margin-right: 10px; transform: scale(1.3);">
                            <span>ผ่านโปรแกรม CPET (Cardiopulmonary Exercise Test)</span>
                        </label>
                    </div>
                </div>

                <div class="mt-3">
                    <button type="submit" class="btn btn-primary" id="submitBtn"
                        style="width: 100%; border-radius: 10px; font-size: 1.2rem;">
                        Register Patient
                    </button>
                </div>

                <!-- Message Area -->
                <div id="messageArea" class="mt-2" style="min-height: 30px;">
                    <!-- Messages will appear here -->
                </div>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="container footer-content">
            <div class="footer-column">
                <img src="../images/logo.png" alt="Ram Hospital" class="footer-logo">
                <div class="footer-address">
                    <p>บริษัท โรงพยาบาล รามคำแหง จำกัด (มหาชน) 436</p>
                    <p>ถนนรามคำแหง แขวงหัวหมาก เขตบางกะปิ</p>
                    <p>กรุงเทพ 10240</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="../javascript/add_patient.js"></script>
    <script>
        // Check doctor authentication
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                const response = await fetch('../../backend/api/check_session.php');
                const data = await response.json();

                if (!data.logged_in || data.role !== 'doctor') {
                    alert('Access denied. Doctors only.');
                    window.location.href = 'login.html';
                }
            } catch (error) {
                console.error('Session check error:', error);
                window.location.href = 'login.html';
            }
        });

        function logout() {
            fetch('../../backend/api/logout.php')
                .then(() => {
                    sessionStorage.clear();
                    window.location.href = 'login.html';
                });
        }
    </script>
</body>

</html>